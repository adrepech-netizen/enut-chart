<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Medias ENUT: Total, Nacional por Sexo y Comparación por Entidad</title>
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
    <style>
        /* Ajuste de estilos para incrustación y responsividad */
        body { font-family: 'Open Sans', sans-serif; margin: 0; padding: 0; }
        .plotly-graph-div { margin: auto; width: 100%; max-width: 100%; height: 500px; } 
    </style>
</head>
<body>
    <div id="plotly-graph"></div>
    <script>
        // ----------------------------------------------------------------------------------
        // --- DATOS GLOBALES ---
        // ----------------------------------------------------------------------------------
        const medias = [58.646446, 62.388214, 56.308151, 56.939297, 60.598232, 64.527916, 56.883587, 59.519478, 58.764233, 62.364307, 59.703575, 63.776394, 56.458565, 60.307858, 53.187004, 55.644093, 59.622387, 59.890213, 60.284916, 67.187553, 55.743652, 59.325527, 56.243843, 63.385593, 64.189293, 66.612022, 56.037392, 60.080231, 58.111305, 59.09721, 56.727734, 63.047134, 57.340054, 59.248878, 53.419842, 60.562645, 60.466278, 62.010601, 55.123337, 63.481098, 61.298454, 63.284061, 61.461536, 66.620789, 62.960716, 62.564732, 57.801552, 62.604576, 51.998241, 58.65733, 57.268551, 61.857254, 60.482002, 60.552914, 55.52512, 59.054958, 60.292324, 65.803665, 58.274921, 63.039871, 60.012993, 59.77224, 58.574898, 59.798546];
        const entidades = ["Aguascalientes", "Aguascalientes", "Baja California", "Baja California", "Baja California Sur", "Baja California Sur", "Campeche", "Campeche", "Coahuila", "Coahuila", "Colima", "Colima", "Chiapas", "Chiapas", "Chihuahua", "Chihuahua", "Ciudad de México", "Ciudad de México", "Durango", "Durango", "Guanajuato", "Guanajuato", "Guerrero", "Guerrero", "Hidalgo", "Hidalgo", "Jalisco", "Jalisco", "México", "México", "Michoacán", "Michoacán", "Morelos", "Morelos", "Nayarit", "Nayarit", "Nuevo León", "Nuevo León", "Oaxaca", "Oaxaca", "Puebla", "Puebla", "Querétaro", "Querétaro", "Quintana Roo", "Quintana Roo", "San Luis Potosí", "San Luis Potosí", "Sinaloa", "Sinaloa", "Sonora", "Sonora", "Tabasco", "Tabasco", "Tamaulipas", "Tamaulipas", "Tlaxcala", "Tlaxcala", "Veracruz", "Veracruz", "Yucatán", "Yucatán", "Zacatecas", "Zacatecas"];
        
        const entidadesUnicas = [...new Set(entidades)].sort();

        // VALORES MARGINALES (TOTAL) DE LAS ENTIDADES 
        const totalesEntidad = {
            "Aguascalientes": 60.612278, "Baja California": 56.639301, "Baja California Sur": 62.648933, "Campeche": 58.267727, "Coahuila": 60.609001, "Colima": 61.810463, "Chiapas": 58.576077, "Chihuahua": 54.445137, "Ciudad de México": 59.76762, "Durango": 64.071907, "Guanajuato": 57.620647, "Guerrero": 60.171589, "Hidalgo": 65.560165, "Jalisco": 58.124298, "México": 58.639942, "Michoacán": 60.160568, "Morelos": 58.368225, "Nayarit": 57.188675, "Nuevo León": 61.284981, "Oaxaca": 59.771526, "Puebla": 62.369919, "Querétaro": 64.175453, "Quintana Roo": 62.76123, "San Luis Potosí": 60.400585, "Sinaloa": 55.665188, "Sonora": 59.632973, "Tabasco": 60.520378, "Tamaulipas": 57.425404, "Tlaxcala": 63.224617, "Veracruz": 60.905773, "Yucatán": 59.88813, "Zacatecas": 59.222832
        };


        function filtrarPorEntidad(entidad) {
            let mediaHombres = 0;
            let mediaMujeres = 0;
            let mediaTotal = totalesEntidad[entidad] || 0; 

            const sexos = ["Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres"];

            for (let i = 0; i < entidades.length; i++) {
                if (entidades[i] === entidad) {
                    if (sexos[i] === "Hombres") {
                        mediaHombres = medias[i];
                    } else if (sexos[i] === "Mujeres") {
                        mediaMujeres = medias[i];
                    }
                }
            }
            return { mediaHombres: mediaHombres, mediaMujeres: mediaMujeres, mediaTotal: mediaTotal };
        }

        // --- VALORES TEXTO REDONDEADOS a 1 decimal para las Traza A y B (data labels) ---
        const y_traceA = Object.values(totalesEntidad);
        const text_traceA = y_traceA.map(y => y.toFixed(1));

        const y_traceB = [61.096561, 57.953423, 59.63578];
        const text_traceB = y_traceB.map(y => y.toFixed(1));

        // ----------------------------------------------------------------------------------
        // --- TRAZAS BASE (3 trazas: A, B, y C unificada) ---
        // ----------------------------------------------------------------------------------
        const hoverFormat = '<b>%{x}</b><br>Media: %{y:.1f} horas<extra></extra>';

        // TRAZA A (Índice 0): Total por Entidad (Marginales)
        var traceA = {
            x: Object.keys(totalesEntidad),
            y: y_traceA,
            name: 'Total Entidad',
            type: 'bar',
            marker: { color: '#1f77b4' },
            visible: true,
            text: text_traceA,
            textposition: 'inside',
            textfont: { color: 'white' },
            hovertemplate: hoverFormat 
        };

        // TRAZA B (Índice 1): Medias Nacionales por Sexo 
        var traceB = {
            x: ["Mujeres", "Hombres", "TOTAL SEXO"], 
            y: y_traceB, 
            name: 'Nacional por Sexo',
            type: 'bar',
            marker: { color: ['#2ca02c', '#ff7f0e', '#d62728'] },
            visible: false,
            text: text_traceB,
            textposition: 'inside',
            textfont: { color: 'white' },
            hovertemplate: hoverFormat 
        };
        
        // TRAZA C UNIFICADA (Índice 2): Comparación por Entidad (Hombres, Mujeres, Total Entidad)
        const primerEntidad = filtrarPorEntidad(entidadesUnicas[0]);
        var traceC_Comparacion = {
            x: ['Mujeres', 'Hombres', 'Total Entidad'],
            y: [primerEntidad.mediaMujeres, primerEntidad.mediaHombres, primerEntidad.mediaTotal],
            name: 'Comparación Entidad', 
            type: 'bar',
            marker: { color: ['#2ca02c', '#ff7f0e', '#d62728'] }, 
            visible: false, 
            text: [primerEntidad.mediaMujeres.toFixed(1), primerEntidad.mediaHombres.toFixed(1), primerEntidad.mediaTotal.toFixed(1)],
            textposition: 'inside',
            textfont: { color: 'white' },
            hovertemplate: hoverFormat 
        };


        var data = [traceA, traceB, traceC_Comparacion]; 

        // ----------------------------------------------------------------------------------
        // --- CONSTRUCCIÓN DEL MENÚ ---
        // ----------------------------------------------------------------------------------

        // 1. Botón para la Opción 1: Total por Entidad (Traza A, Índice 0)
        const botonTotalEntidad = {
            label: '1. Total por Entidad (Marginal)',
            method: 'update',
            args: [
                { 'visible': [true, false, false] }, 
                { 'title': 'Media Ponderada Total por Entidad Federativa', 'xaxis.title': 'Entidad Federativa', 'barmode': 'group' }
            ]
        };

        // 2. Botón para la Opción 2: Total Nacional por Sexo (Traza B, Índice 1)
        const botonTotalNacional = {
            label: '2. Total Nacional por Sexo',
            method: 'update',
            args: [
                { 'visible': [false, true, false] }, 
                { 'title': 'Media Ponderada Nacional por Sexo', 'xaxis.title': 'Sexo', 'barmode': 'group' }
            ]
        };

        // 3. Botones de Filtrado Dinámico (Traza C_Comparacion, Índice 2)
        const botonesComparacion = entidadesUnicas.map((entidad, index) => {
            const datosFiltrados = filtrarPorEntidad(entidad);
            
            const y_data = [datosFiltrados.mediaMujeres, datosFiltrados.mediaHombres, datosFiltrados.mediaTotal];
            const text_data = y_data.map(y => y.toFixed(1));
            
            return {
                label: `3. Sexo en: ${entidad}`,
                method: 'update',
                args: [
                    {
                        'visible': [false, false, true], 
                        'y': [traceA.y, traceB.y, y_data], 
                        'text': [traceA.text, traceB.text, text_data],
                        'x': [traceA.x, traceB.x, ['Mujeres', 'Hombres', 'Total Entidad']],
                        'marker.color': [traceA.marker.color, traceB.marker.color, ['#2ca02c', '#ff7f0e', '#d62728']]
                    },
                    {
                        'title': `Comparación de Medias por Sexo y Total en ${entidad}`,
                        'xaxis.title': 'Sexo / Total Entidad',
                        'barmode': 'group'
                    }
                ]
            };
        });

        const todosLosBotones = [
            botonTotalEntidad,
            botonTotalNacional,
            ...botonesComparacion 
        ];
        
        // ----------------------------------------------------------------------------------
        // --- LAYOUT FINAL (Optimizado para Móviles) ---
        // ----------------------------------------------------------------------------------

        var layout = {
            title: { 
                text: 'Media Ponderada Total por Entidad Federativa',
                font: { size: 14 } // Reducir tamaño de título para móviles
            },
            xaxis: { 
                title: 'Entidad Federativa',
                automargin: true,
                tickfont: { size: 10 } // Reducir tamaño de etiquetas X
            },
            yaxis: { 
                title: 'Media de Horas de Trabajo', 
                range: [50, 70],
                tickformat: '.1f',
                automargin: true,
                tickfont: { size: 10 } // Reducir tamaño de etiquetas Y
            },
            margin: {
                l: 40, 
                r: 10,
                t: 100, 
                b: 80,
                pad: 0
            },
            barmode: 'group',
            updatemenus: [{
                buttons: todosLosBotones,
                direction: 'down',
                showactive: true,
                // **Ajustes para que el menú sea accesible en móviles:**
                x: 0.05, // Colocar el menú más a la izquierda
                xanchor: 'left', // Anclado a la izquierda para evitar que se salga de la pantalla
                y: 1.1, 
                yanchor: 'top',
                font: { size: 10 } // Reducir el tamaño de la fuente del menú
            }]
        };

        // --- CREAR GRÁFICO ---
        Plotly.newPlot('plotly-graph', data, layout, {
            responsive: true,
            displayModeBar: false // Opcional: Oculta la barra de herramientas de Plotly para dar más espacio
        });
    </script>
</body>
</html>
