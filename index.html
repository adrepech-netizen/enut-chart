<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Comparación de Medias por Sexo y Entidad</title>
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
    <style>
        body { font-family: 'Open Sans', sans-serif; margin: 20px; }
        .plotly-graph-div { margin: auto; max-width: 90%; }
    </style>
</head>
<body>
    <div id="plotly-graph"></div>
    <script>
        // --- DATOS GLOBALES (Incluyen solo Hombres y Mujeres por Entidad) ---
        // Estos datos se usarán para el filtrado dinámico.

        // Datos: Media de Horas de Trabajo (activ_prod_sin_cp)
        const medias = [58.646446, 62.388214, 56.308151, 56.939297, 60.598232, 64.527916, 56.883587, 59.519478, 58.764233, 62.364307, 59.703575, 63.776394, 56.458565, 60.307858, 53.187004, 55.644093, 59.622387, 59.890213, 60.284916, 67.187553, 55.743652, 59.325527, 56.243843, 63.385593, 64.189293, 66.612022, 56.037392, 60.080231, 58.111305, 59.09721, 56.727734, 63.047134, 57.340054, 59.248878, 53.419842, 60.562645, 60.466278, 62.010601, 55.123337, 63.481098, 61.298454, 63.284061, 61.461536, 66.620789, 62.960716, 62.564732, 57.801552, 62.604576, 51.998241, 58.65733, 57.268551, 61.857254, 60.482002, 60.552914, 55.52512, 59.054958, 60.292324, 65.803665, 58.274921, 63.039871, 60.012993, 59.77224, 58.574898, 59.798546];

        // Etiquetas: Entidad Federativa (Repetida para Hombres y Mujeres)
        const entidades = ["Aguascalientes", "Aguascalientes", "Baja California", "Baja California", "Baja California Sur", "Baja California Sur", "Campeche", "Campeche", "Coahuila", "Coahuila", "Colima", "Colima", "Chiapas", "Chiapas", "Chihuahua", "Chihuahua", "Ciudad de México", "Ciudad de México", "Durango", "Durango", "Guanajuato", "Guanajuato", "Guerrero", "Guerrero", "Hidalgo", "Hidalgo", "Jalisco", "Jalisco", "México", "México", "Michoacán", "Michoacán", "Morelos", "Morelos", "Nayarit", "Nayarit", "Nuevo León", "Nuevo León", "Oaxaca", "Oaxaca", "Puebla", "Puebla", "Querétaro", "Querétaro", "Quintana Roo", "Quintana Roo", "San Luis Potosí", "San Luis Potosí", "Sinaloa", "Sinaloa", "Sonora", "Sonora", "Tabasco", "Tabasco", "Tamaulipas", "Tamaulipas", "Tlaxcala", "Tlaxcala", "Veracruz", "Veracruz", "Yucatán", "Yucatán", "Zacatecas", "Zacatecas"];

        // Etiquetas: Sexo (Alternando Hombres/Mujeres)
        const sexos = ["Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres", "Hombres", "Mujeres"];

        // --- FUNCIONES DE FILTRADO ---
        // 1. Obtiene una lista única y ordenada de entidades.
        const entidadesUnicas = [...new Set(entidades)].sort();

        // 2. Función que filtra los datos para una entidad dada
        function filtrarPorEntidad(entidad) {
            let mediaHombres = 0;
            let mediaMujeres = 0;

            for (let i = 0; i < entidades.length; i++) {
                if (entidades[i] === entidad) {
                    if (sexos[i] === "Hombres") {
                        mediaHombres = medias[i];
                    } else if (sexos[i] === "Mujeres") {
                        mediaMujeres = medias[i];
                    }
                }
            }
            return {
                mediaHombres: mediaHombres,
                mediaMujeres: mediaMujeres
            };
        }

        // --- TRAZAS INICIALES (Muestra Aguascalientes por defecto) ---
        const datosIniciales = filtrarPorEntidad(entidadesUnicas[0]);

        var data = [
            {
                x: ["Hombres", "Mujeres"],
                y: [datosIniciales.mediaHombres, datosIniciales.mediaMujeres],
                name: entidadesUnicas[0],
                type: 'bar',
                marker: { color: ['#ff7f0e', '#2ca02c'] },
            }
        ];

        // --- LAYOUT Y CONTROLES ---
        
        // 1. Construir los botones para el menú desplegable (un botón por estado)
        const dropdownButtons = entidadesUnicas.map(entidad => {
            return {
                label: entidad,
                method: 'update',
                args: [
                    // args[0]: Data (Valores Y)
                    {
                        'y': [[filtrarPorEntidad(entidad).mediaHombres, filtrarPorEntidad(entidad).mediaMujeres]],
                        'x': [['Hombres', 'Mujeres']]
                    },
                    // args[1]: Layout (Título y Nombre de la Traza)
                    {
                        'title': `Comparación de Medias por Sexo: ${entidad}`,
                        'name': [entidad]
                    }
                ]
            };
        });

        var layout = {
            title: `Comparación de Medias por Sexo: ${entidadesUnicas[0]}`, // Título inicial
            xaxis: { title: 'Sexo' },
            yaxis: { title: 'Media de Horas de Trabajo', range: [50, 70] },
            barmode: 'group',
            updatemenus: [{
                buttons: dropdownButtons,
                direction: 'down',
                showactive: true,
                x: 0.1,
                xanchor: 'left',
                y: 1.1,
                yanchor: 'top',
                active: 0 // Estado activo por defecto (Aguascalientes)
            }]
        };

        // --- CREAR GRÁFICO ---
        Plotly.newPlot('plotly-graph', data, layout);
    </script>
</body>
</html>
